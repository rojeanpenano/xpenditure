<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Management</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1 class="page-title">Budget Management</h1>

        <form id="budgetForm" class="form">
            <div class="form-group">
                <label for="category">Category:</label>
                <input type="text" id="category" name="category" required>
            </div>
            <div class="form-group">
                <label for="amount">Budget Amount:</label>
                <input type="number" id="amount" name="amount" required>
            </div>
            <button type="submit" class="btn">Set Budget</button>
        </form>

        <h2>Current Budgets</h2>
        <ul id="budgetList" class="list"></ul>

        <p id="feedback" class="feedback" style="display:none;"></p>
    </div>

    <script type="module">
        import { BASE_URL } from './apiConfig.js';

        const budgetForm = document.getElementById('budgetForm');
        const budgetList = document.getElementById('budgetList');
        const feedback = document.getElementById('feedback');

        const fetchBudgets = async () => {
            try {
                const response = await fetch(`${BASE_URL}/budgets`, {
                    headers: { Authorization: `Bearer ${localStorage.getItem('token')}` },
                });
                if (!response.ok) throw new Error('Failed to fetch budgets');
                const budgets = await response.json();

                budgetList.innerHTML = '';
                if (budgets.length === 0) {
                    budgetList.innerHTML = '<li>No budgets available</li>';
                } else {
                    budgets.forEach(budget => {
                        const listItem = document.createElement('li');
                        listItem.textContent = `${budget.category}: $${budget.amount}`;
                        budgetList.appendChild(listItem);
                    });
                }
            } catch (error) {
                budgetList.innerHTML = `<li>Error fetching budgets: ${error.message}</li>`;
            }
        };

        budgetForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const category = document.getElementById('category').value;
            const amount = parseFloat(document.getElementById('amount').value);

            try {
                const response = await fetch(`${BASE_URL}/budgets`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        Authorization: `Bearer ${localStorage.getItem('token')}`,
                    },
                    body: JSON.stringify({ category, amount }),
                });

                if (response.ok) {
                    feedback.style.display = 'block';
                    feedback.textContent = 'Budget set successfully!';
                    fetchBudgets();
                } else {
                    const errorData = await response.json();
                    feedback.style.display = 'block';
                    feedback.textContent = errorData.message || 'Failed to set budget';
                }
            } catch (error) {
                feedback.style.display = 'block';
                feedback.textContent = `Network error: ${error.message}`;
            }
        });

        fetchBudgets();
    </script>
</body>
</html>
